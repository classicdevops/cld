The **infraconfig** module collects basic configuration information from remote instances.

### Usage
```
cld-infraconfig [PATTERN1] [PATTERN2] [PATTERN3] [options]
```
Options:
- `--groups=GROUP1,GROUP2` – filter instances by groups.
- `--dirs=/etc,/path` – comma separated list of directories to copy from each instance (default `/etc`).
- `--commit` – after collecting data commit changes to the CLD git repository. The commit message is generated by OpenAI GPT‑4.1‑mini using the diff.
- `--all` – admin option to search instances across all groups.

Collected files are stored under `/var/cld/modules/infraconfig/data/instances/INSTANCE/`.

### Custom commands and directories
The module looks for optional files under `modules/infraconfig/data` to adjust what
is collected:

- `data/instances/<instance>/dirs` – newline separated directories to copy
- `data/instances/<instance>/commands` – shell commands executed on the instance
- `data/groups/<group>/dirs` and `data/groups/<group>/commands` work the same for groups.

If no custom files are found the script copies `/etc` and runs a default command
set (`netstat -plunt`, `nproc`, `free -h`, `df -h`).

### OpenAI integration
Run `modules/infraconfig/init` once to store your OpenAI API key in the
`/var/cld/creds/creds` file as `OPENAI_API_KEY`. When `--commit` is
used, `cld-infraconfig` will call the OpenAI API to create a concise
commit message from the staged diff.
