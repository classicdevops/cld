<html lang="en">
  <head>
    <title>CLD Web - Infraconfig</title>
    {% include 'html/include/head.html' %}
  </head>
  <body>
    <div class="page-container">
      {% include 'html/include/navbar.html' %}
      <div class="container"><br><br>
        <h4 class="panel-title">Infra configuration collection</h4><br>
        <form onsubmit="return runInfraconfig();">
          <label>Group:</label>
          <select id="groupSelect" class="form-control" style="width:auto;display:inline-block">
            <option value="">--any--</option>
            {% for cld_group in cld_groups %}
              <option value="{{ cld_group }}">{{ cld_group }}</option>
            {% endfor %}
          </select>
          <label>Instance:</label>
          <select id="instanceSelect" class="form-control" style="width:auto;display:inline-block">
            {% for cld_instance in cld_instances %}
              <option value="{{ cld_instance }}">{{ cld_instance }}</option>
            {% endfor %}
          </select>
          <label style="margin-left:10px"><input type="checkbox" id="commitCheck" value="1"> Commit</label>
          <button type="submit" class="btn btn-primary" style="margin-left:10px">Run</button>
        </form>
        <div id="output" style="margin-top:10px"></div>
        <script>
          function runInfraconfig() {
            var group = document.getElementById('groupSelect').value;
            var inst = document.getElementById('instanceSelect').value;
            var commit = document.getElementById('commitCheck').checked;
            var args = inst;
            if (group) args += ' --groups=' + group;
            if (commit) args += ' --commit';
            var frame = document.createElement('iframe');
            frame.style = 'width:100%;height:400px;border:0;';
            frame.src = '/tool/cld-infraconfig/' + encodeURIComponent(args.trim());
            var out = document.getElementById('output');
            out.innerHTML = '';
            out.appendChild(frame);
            return false;
          }
        </script>
      </div>
    </div>
  </body>
</html>
